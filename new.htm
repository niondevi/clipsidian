<!DOCTYPE html>
<html>

<body>
  <script>
    window.onload = () => {
      // Get the URL parameters
      var params = new URLSearchParams(window.location.search);

      // Check if it's a success callback
      if (params.has('x-success')) {
        // This is a success callback, send a message to close the tab
        chrome.runtime.sendMessage({ type: "CLOSE_TAB" });
        return;
      }

      // Construct the Obsidian URL
      var obsidianUrl = new URL('obsidian://new');
      obsidianUrl.searchParams.append('vault', decodeURIComponent(params.get('vault')));
      obsidianUrl.searchParams.append('file', decodeURIComponent(params.get('file')));
      obsidianUrl.searchParams.append('content', decodeURIComponent(params.get('content')));
      obsidianUrl.searchParams.append('append', params.get('append') === 'true');
      obsidianUrl.searchParams.append('overwrite', params.get('overwrite') === 'true');
      obsidianUrl.searchParams.append('silent', params.get('silent') === 'true');

      // Add x-success callback URL
      var callbackUrl = new URL(window.location.href);
      callbackUrl.searchParams.append('x-success', 'true');
      obsidianUrl.searchParams.append('x-success', encodeURIComponent(callbackUrl.toString()));

      // Redirect to the Obsidian URL
      window.location.href = obsidianUrl.toString();
    };
  </script>
</body>

</html>